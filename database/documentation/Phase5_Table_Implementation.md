# Phase V: Table Implementation & Data Insertion

**Project:** Hospital ER Triage & Resource Allocation System  
**Student:** Denyse (MON_27976)  
**Database:** Oracle XE 21c  
**PDB:** mon_27976_denyse_ertriage_db  
**Date:** December 2025

---

## Overview

Phase V implements the complete database schema with 15 normalized tables, enforces data integrity through comprehensive constraints, and populates the database with realistic sample data for testing and validation.

---

## Deliverables Summary

### ✅ 1. CREATE Scripts
**File:** `database/scripts/phase5_create_tables.sql`

Creates all 15 tables with:
- Primary keys (identity-generated)
- Foreign key relationships
- Check constraints for data validation
- Unique constraints for business keys
- NOT NULL constraints for mandatory fields
- Proper tablespace allocation (ER_DATA_TBS for tables, ER_INDEX_TBS for indexes)

**Tables Created:**
1. TRIAGE_LEVELS (4 severity levels)
2. PATIENTS (demographic information)
3. MEDICAL_STAFFS (ER staff members)
4. SHIFTS (staff scheduling)
5. ER_BEDS (bed inventory & status)
6. MEDICAL_EQUIPMENTS (equipment catalog)
7. SUPPLIES (supply types)
8. SUPPLY_INVENTORY (stock levels)
9. MEDICATIONS_ADMINISTERED (medication records)
10. ER_ARRIVALS (patient arrivals & triage)
11. TREATMENT_SESSIONS (treatment tracking)
12. CRITICAL_ALERTS (critical patient alerts)
13. ER_MEDS (medication catalog) 
14. ER_AUDIT_LOG (procedure audit trail)
15. ER_ERROR_LOG (error logging)

### ✅ 2. INSERT Scripts
**File:** `database/scripts/phase5_insert_data.sql`

Inserts realistic sample data:
- **TRIAGE_LEVELS:** 4 levels (Critical, Urgent, Semi-Urgent, Non-Urgent)
- **PATIENTS:** 20+ patient records with diverse demographics
- **MEDICAL_STAFFS:** 15+ staff members (physicians, nurses, managers)
- **ER_BEDS:** 15+ beds with various zones and statuses
- **MEDICAL_EQUIPMENTS:** 10+ equipment items
- **SUPPLIES:** 10+ supply types
- **ER_ARRIVALS:** 10+ patient arrival records
- **TREATMENT_SESSIONS:** Multiple treatment records
- **SHIFTS:** Staff scheduling data
- **SUPPLY_INVENTORY:** Current stock levels

### ✅ 3. Validation Queries
**File:** `database/scripts/phase5_validation_queries.sql`

Comprehensive validation queries to verify:
- Table creation and structure
- Data insertion success
- Constraint enforcement
- Foreign key relationships
- Data integrity
- Sample data retrieval

**Query Categories:**
- Table structure validation
- Row count verification
- Constraint checking
- Relationship validation
- Sample data display (5-10 rows per table)
- Join queries across related tables

### ✅ 4. Test Results
**Location:** `test_results/phase5_execution/`

Evidence of successful execution:
- Table creation confirmations
- Data insertion results
- Validation query outputs
- Row counts and sample data displays
- Constraint violation tests (if applicable)

---

## Table Implementation Details

### 1. TRIAGE_LEVELS
```sql
CREATE TABLE triage_levels (
  triage_level_id   NUMBER GENERATED BY DEFAULT AS IDENTITY,
  triage_name       VARCHAR2(20) NOT NULL UNIQUE,
  priority_order    NUMBER NOT NULL CHECK (priority_order BETWEEN 1 AND 4),
  avg_wait_minutes  NUMBER,
  CONSTRAINT pk_triage_levels PRIMARY KEY (triage_level_id)
) TABLESPACE er_data_tbs;
```

**Sample Data:**
- Critical (Priority 1, 0-5 min wait)
- Urgent (Priority 2, 15-30 min wait)
- Semi-Urgent (Priority 3, 60 min wait)
- Non-Urgent (Priority 4, 120 min wait)

### 2. PATIENTS
```sql
CREATE TABLE patients (
  patient_id        NUMBER GENERATED BY DEFAULT AS IDENTITY,
  national_id       VARCHAR2(20) NOT NULL UNIQUE,
  first_name        VARCHAR2(50) NOT NULL,
  last_name         VARCHAR2(50) NOT NULL,
  date_of_birth     DATE NOT NULL,
  gender            VARCHAR2(10) CHECK (gender IN ('Male','Female','Other')),
  phone_number      VARCHAR2(20),
  email             VARCHAR2(100),
  address_line1     VARCHAR2(100),
  city              VARCHAR2(50),
  created_date      DATE DEFAULT SYSDATE,
  CONSTRAINT pk_patients PRIMARY KEY (patient_id)
) TABLESPACE er_data_tbs;
```

**Data Volume:** 20+ diverse patient records

### 3. MEDICAL_STAFFS
```sql
CREATE TABLE medical_staffs (
  staff_id          NUMBER GENERATED BY DEFAULT AS IDENTITY,
  staff_number      VARCHAR2(20) NOT NULL UNIQUE,
  first_name        VARCHAR2(50) NOT NULL,
  last_name         VARCHAR2(50) NOT NULL,
  role              VARCHAR2(30) NOT NULL CHECK (role IN ('Triage Nurse','ER Physician','Bed Manager','Support Staff')),
  department        VARCHAR2(50),
  phone_number      VARCHAR2(20),
  email             VARCHAR2(100),
  active_flag       CHAR(1) DEFAULT 'Y' CHECK (active_flag IN ('Y','N')),
  CONSTRAINT pk_medical_staffs PRIMARY KEY (staff_id)
) TABLESPACE er_data_tbs;
```

**Data Volume:** 15+ staff members across all roles

### 4. ER_BEDS
```sql
CREATE TABLE er_beds (
  bed_id            NUMBER GENERATED BY DEFAULT AS IDENTITY,
  bed_code          VARCHAR2(20) NOT NULL UNIQUE,
  location_zone     VARCHAR2(30) NOT NULL,
  is_isolation      CHAR(1) DEFAULT 'N' CHECK (is_isolation IN ('Y','N')),
  status            VARCHAR2(20) DEFAULT 'Available' CHECK (status IN ('Available','Occupied','Cleaning','OutOfService')),
  CONSTRAINT pk_er_beds PRIMARY KEY (bed_id)
) TABLESPACE er_data_tbs;
```

**Data Volume:** 15+ beds with various statuses and zones

### 5. ER_ARRIVALS (with Foreign Keys)
```sql
CREATE TABLE er_arrivals (
  arrival_id        NUMBER GENERATED BY DEFAULT AS IDENTITY,
  patient_id        NUMBER NOT NULL,
  triage_level_id   NUMBER NOT NULL,
  arrival_datetime  DATE DEFAULT SYSDATE NOT NULL,
  chief_complaint   VARCHAR2(200),
  arrival_status    VARCHAR2(20) DEFAULT 'Waiting' CHECK (arrival_status IN ('Waiting','In Treatment','Discharged','Left AMA')),
  assigned_bed_id   NUMBER,
  CONSTRAINT pk_er_arrivals PRIMARY KEY (arrival_id),
  CONSTRAINT fk_arrivals_patient FOREIGN KEY (patient_id) REFERENCES patients(patient_id),
  CONSTRAINT fk_arrivals_triage FOREIGN KEY (triage_level_id) REFERENCES triage_levels(triage_level_id),
  CONSTRAINT fk_arrivals_bed FOREIGN KEY (assigned_bed_id) REFERENCES er_beds(bed_id)
) TABLESPACE er_data_tbs;
```

**Data Volume:** 10+ arrival records with various statuses

---

## Constraint Summary

### Primary Keys: 15
Every table has an identity-generated primary key for unique row identification.

### Foreign Keys: 15+
Referential integrity enforced between:
- ER_ARRIVALS → PATIENTS, TRIAGE_LEVELS, ER_BEDS
- TREATMENT_SESSIONS → ER_ARRIVALS, MEDICAL_STAFFS
- SHIFTS → MEDICAL_STAFFS
- SUPPLY_INVENTORY → SUPPLIES
- MEDICATIONS_ADMINISTERED → PATIENTS, MEDICAL_STAFFS
- CRITICAL_ALERTS → ER_ARRIVALS, MEDICAL_STAFFS

### Check Constraints: 20+
Data validation for:
- Status values (Available, Occupied, Cleaning, OutOfService)
- Gender values (Male, Female, Other)
- Active flags (Y, N)
- Isolation flags (Y, N)
- Priority orders (1-4)
- Arrival statuses (Waiting, In Treatment, Discharged, Left AMA)
- Staff roles (Triage Nurse, ER Physician, Bed Manager, Support Staff)

### Unique Constraints: 10+
Business key uniqueness:
- National IDs
- Staff numbers
- Bed codes
- Equipment codes
- Triage names

### NOT NULL Constraints: 50+
Mandatory fields enforced across all tables.

---

## Validation Query Examples

### 1. Table Structure Verification
```sql
-- Check all tables exist
SELECT table_name, tablespace_name
FROM user_tables
WHERE table_name IN ('TRIAGE_LEVELS', 'PATIENTS', 'MEDICAL_STAFFS', 'ER_BEDS', 'ER_ARRIVALS')
ORDER BY table_name;
```

### 2. Row Count Verification
```sql
-- Verify data insertion
SELECT 'TRIAGE_LEVELS' AS table_name, COUNT(*) AS row_count FROM triage_levels
UNION ALL
SELECT 'PATIENTS', COUNT(*) FROM patients
UNION ALL
SELECT 'MEDICAL_STAFFS', COUNT(*) FROM medical_staffs
UNION ALL
SELECT 'ER_BEDS', COUNT(*) FROM er_beds
UNION ALL
SELECT 'ER_ARRIVALS', COUNT(*) FROM er_arrivals;
```

**Expected Results:**
```
TABLE_NAME          ROW_COUNT
------------------- ---------
TRIAGE_LEVELS               4
PATIENTS                  20+
MEDICAL_STAFFS            15+
ER_BEDS                   15+
ER_ARRIVALS               10+
```

### 3. Constraint Verification
```sql
-- Check primary keys
SELECT table_name, constraint_name, constraint_type
FROM user_constraints
WHERE constraint_type = 'P'
  AND table_name LIKE '%'
ORDER BY table_name;

-- Check foreign keys
SELECT 
  a.table_name AS child_table,
  a.constraint_name,
  b.table_name AS parent_table
FROM user_constraints a
JOIN user_constraints b ON a.r_constraint_name = b.constraint_name
WHERE a.constraint_type = 'R'
ORDER BY a.table_name;
```

### 4. Sample Data Display
```sql
-- Display triage levels with priority
SELECT triage_name, priority_order, avg_wait_minutes
FROM triage_levels
ORDER BY priority_order;

-- Show patients with demographics
SELECT first_name, last_name, gender, 
       TRUNC(MONTHS_BETWEEN(SYSDATE, date_of_birth)/12) AS age
FROM patients
FETCH FIRST 10 ROWS ONLY;

-- Display staff by role
SELECT staff_number, first_name, last_name, role, department
FROM medical_staffs
WHERE active_flag = 'Y'
ORDER BY role, last_name;
```

### 5. Join Query Validation
```sql
-- Patient arrivals with triage levels
SELECT 
  p.first_name || ' ' || p.last_name AS patient_name,
  t.triage_name,
  ea.arrival_datetime,
  ea.chief_complaint,
  ea.arrival_status
FROM er_arrivals ea
JOIN patients p ON ea.patient_id = p.patient_id
JOIN triage_levels t ON ea.triage_level_id = t.triage_level_id
ORDER BY ea.arrival_datetime DESC;
```

---

## Execution Results Summary

### ✅ Tables Created: 15/15
All tables created successfully in ER_DATA_TBS with proper constraints.

### ✅ Indexes Created: 15+
All foreign key and business key indexes created in ER_INDEX_TBS.

### ✅ Data Inserted: 100+ rows
Realistic sample data inserted across all tables.

### ✅ Constraints Enforced: 50+
All primary keys, foreign keys, check constraints, and unique constraints active.

### ✅ Validation Passed: 100%
All validation queries executed successfully with expected results.

---

## Sample Query Results

### Triage Levels
```
TRIAGE_NAME     PRIORITY_ORDER  AVG_WAIT_MINUTES
--------------- -------------- -----------------
Critical                     1                 5
Urgent                       2                30
Semi-Urgent                  3                60
Non-Urgent                   4               120
```

### Current ER Status
```
ARRIVAL_STATUS  PATIENT_COUNT
--------------- -------------
Waiting                     3
In Treatment                5
Discharged                  2
```

### Bed Availability
```
STATUS          BED_COUNT
--------------- ---------
Available               8
Occupied                5
Cleaning                1
OutOfService            1
```

---

## Files and Locations

| File | Location | Purpose |
|------|----------|---------|
| `phase5_create_tables.sql` | `database/scripts/` | CREATE TABLE statements |
| `phase5_insert_data.sql` | `database/scripts/` | INSERT statements |
| `phase5_validation_queries.sql` | `database/scripts/validation/` | Validation queries |
| Test screenshots | `test_results/phase5_execution/` | Execution evidence |

---

## Execution Instructions

### Step 1: Create Tables
```sql
-- Connect as DENYSE_ADMIN
CONN denyse_admin/password@localhost:1521/mon_27976_denyse_ertriage_db

-- Run table creation script
@database/scripts/phase5_create_tables.sql
```

### Step 2: Insert Data
```sql
-- Run data insertion script
@database/scripts/phase5_insert_data.sql

-- Commit changes
COMMIT;
```

### Step 3: Validate
```sql
-- Run validation queries
@database/scripts/phase5_validation_queries.sql
```

---

## GitHub Submission Checklist

- ✅ `phase5_create_tables.sql` committed
- ✅ `phase5_insert_data.sql` committed
- ✅ `phase5_validation_queries.sql` committed
- ✅ Test result screenshots captured
- ✅ Documentation completed
- ✅ All queries execute without errors
- ✅ Data integrity verified

---

## Next Steps

✅ **Phase V Complete** → Proceed to Phase VI (PL/SQL Packages)

---

**Document Status:** ✅ Complete  
**Last Updated:** December 7, 2025  
**Validated By:** Denyse (MON_27976)
